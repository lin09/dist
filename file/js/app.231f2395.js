(function(e){function t(t){for(var a,o,s=t[0],c=t[1],l=t[2],f=0,d=[];f<s.length;f++)o=s[f],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&d.push(r[o][0]),r[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(d.length)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={app:0},i=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="https://cdn.jsdelivr.net/gh/lin09/dist/file/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"4e72":function(e,t){e.exports=antd},"56d7":function(e,t,n){"use strict";n.r(t);n("bf53"),n("b7eb"),n("d7c3"),n("c304");var a=n("60bb"),r=n.n(a),i=n("8bbf"),o=n.n(i),s=n("4e72"),c=n.n(s),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("a-layout",{staticStyle:{"min-height":"100vh"}},[n("Header"),n("a-layout-content",[n("router-view"),n("a-back-top")],1),n("a-layout-footer",{staticStyle:{"text-align":"center"}},[e._v(" FOS v."+e._s(e.APP_VERSION)+" ©2020 Created by "),n("a",{attrs:{href:"https://saileidigi.cn",target:"_blank",rel:"noopener noreferrer"}},[e._v(" saileidigi ")])])],1)],1)},u=[],f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-layout-header",{staticStyle:{background:"#fff"}},[a("a-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[a("a-row",{attrs:{type:"flex",align:"middle"}},[a("a-row",{attrs:{type:"flex",align:"middle"}},[a("img",{staticStyle:{height:"32px"},attrs:{alt:"File logo",src:n("9b19")}}),a("h1",{staticStyle:{margin:"0 8px"}},[e._v("文件")])])],1),a("a-row",{attrs:{type:"flex",align:"middle"}},[a("UserMenu"),a("Fullscreen")],1)],1)],1)},d=[],p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-row",{attrs:{type:"flex",align:"middle"}},[e.detail.id?n("a-dropdown",{attrs:{placement:"bottomCenter"}},[n("a",{staticClass:"ant-dropdown-link",staticStyle:{margin:"0 20px","line-height":"32px"}},[n("a-row",{attrs:{type:"flex",align:"middle"}},[[e.detail.avatar?n("a-avatar",{attrs:{src:e._f("cdn")(e.detail.avatar)}}):n("a-avatar",{staticStyle:{background:"#1890ff"},attrs:{icon:"user"}})],n("span",{staticStyle:{"margin-left":"8px"}},[e._v(" "+e._s(e.detail.name)+" ")])],2)],1),n("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[n("a-menu-item",[n("a",{staticStyle:{padding:"8px 40px"},attrs:{href:e._f("accountF")("/")}},[n("a-icon",{attrs:{type:"appstore"}}),e._v(" 我的系统 ")],1)]),n("a-menu-item",[n("a",{staticStyle:{padding:"8px 40px"},attrs:{href:e._f("accountF")("/user")}},[n("a-icon",{attrs:{type:"user"}}),e._v(" 个人中心 ")],1)]),n("a-menu-item",[n("a",{staticStyle:{padding:"8px 40px"},attrs:{href:e._f("accountF")("/loginList")}},[n("a-icon",{attrs:{type:"login"}}),e._v(" 登录记录 ")],1)]),n("a-menu-divider"),n("a-menu-item",[n("a-button",{attrs:{block:"",type:"link",icon:"logout",size:"small"},on:{click:e.logout}},[e._v(" 退出 ")])],1)],1)],1):n("a-button",{attrs:{type:"link"},on:{click:e.goLogin}},[e._v(" 登录 ")])],1)},h=[],g=n("3c43"),m=(n("9be4"),n("cebe")),v=n.n(m),y=(n("a20b"),n("ea0d"),n("c32d")),b=n.n(y),x="account_token",w=function(e){var t={};try{t=JSON.parse(atob((e+"").replace(/(.+)\..+/,"$1")))}catch(n){window.console.error(n)}return t},_=function(e){return w(e).exp>b()().unix()+1800},O=function(){var e=localStorage.getItem(x);return e&&_(e)?e:""},S=function(e){return!(!e||!_(e))&&(localStorage.setItem(x,e),!0)},j=function(){var e=O();return e?w(e).id:0},T=function(){return localStorage.removeItem(x)},F=function(e){var t=v.a.create(e);return t.interceptors.request.use((function(e){return!1!==e.useAuth&&(e.headers.auth=e.headers.auth||O()),e}),(function(e){return s["notification"].error({message:e.message}),Promise.reject(e)})),t.interceptors.response.use((function(e){return e.data}),(function(e){return!1!==e.config.showError&&s["notification"].error({message:r.a.get(e,"response.status")||e.message,description:r.a.get(e,"response.data")}),Promise.reject(e)})),t},L=function(e){return new Promise((function(t,n){var a=new FileReader;a.addEventListener("load",(function(){t(a.result)})),a.addEventListener("error",n),a.readAsDataURL(e)}))},E=function(e){return new Promise((function(t,n){var a=new Image;a.addEventListener("load",(function(){t(a)})),a.addEventListener("error",n),a.src=e}))},k=(n("7941"),{IS_DEV:!1});Object.freeze(k);var A="saileidigi.cn",P={OSS:"oss.".concat(A),OOS:"oos.".concat(A)};Object.freeze(P);var $={ACCOUNT_API:"https://account-api.".concat(P.OOS),ACCOUNT_FRONTEND:"https://account.".concat(P.OOS),OSS:"https://".concat(P.OSS),CDN:"https://cdn.jsdelivr.net/gh/lin09/files"};Object.freeze($);var N=F({baseURL:$.ACCOUNT_API}),C=F({baseURL:$.OSS,useAuth:!1}),I=function(){return N.post("/query/all",{table:{name:"user",no_default_field:!0,fields:["id","avatar","name"],filters:[[["id","=",j()]]]}}).then((function(e){return e.data[0]}))},U=function(){return N.get("/file/auth")},D=function(e){return C.get("/info/"+e)},R={data:function(){return{detail:{id:j()}}},beforeMount:function(){var e=this;this.detail.id&&I().then((function(t){e.detail=Object(g["a"])({},t)}))},methods:{logout:function(){this.detail={},T()},goLogin:function(){this.$router.goLogin()}}},q=R,z=n("94cc"),M=Object(z["a"])(q,p,h,!1,null,null,null),V=M.exports,H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-icon",{staticStyle:{"font-size":"32px",cursor:"pointer"},attrs:{type:e.isFullscreen?"fullscreen-exit":"fullscreen"},on:{click:e.toggleFullscreen}})},J=[],B={data:function(){return{isFullscreen:!1}},methods:{toggleFullscreen:function(){this.isFullscreen?document.exitFullscreen():document.documentElement.requestFullscreen()}},mounted:function(){var e=this;document.addEventListener("fullscreenchange",(function(){e.isFullscreen=document.fullscreenElement}))}},G=B,K=Object(z["a"])(G,H,J,!1,null,null,null),Q=K.exports,W={components:{UserMenu:V,Fullscreen:Q}},X=W,Y=Object(z["a"])(X,f,d,!1,null,null,null),Z=Y.exports,ee={name:"app",components:{Header:Z},data:function(){return{APP_VERSION:"0.1.0"}}},te=ee,ne=Object(z["a"])(te,l,u,!1,null,null,null),ae=ne.exports,re=(n("41fd"),n("f1e0"),n("6389")),ie=n.n(re),oe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-result",{attrs:{status:"404",title:"404",subTitle:"Sorry, the page you visited does not exist."}})},se=[],ce={},le=Object(z["a"])(ce,oe,se,!1,null,null,null),ue=le.exports,fe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{padding:"20px"}},[e.detailLoading?n("a-spin"):e.err.status?n("a-result",{attrs:{status:"error",title:e.err.status,subTitle:e.err.message}}):n("a-card",{staticStyle:{margin:"auto","max-width":"1024px"}},[n("span",{attrs:{slot:"title"},slot:"title"},[n("TitleIcon",{attrs:{"file-type":e.detail.type}}),e._v(" "+e._s(e.detail.name)+" ")],1),n("a-button",{attrs:{slot:"extra",type:"link",loding:e.saveLoading},on:{click:e.saveAs},slot:"extra"},[e._v(" 另存为 ")]),e.previewType?[e.fileLoading?n("a-progress",{attrs:{percent:e.percent,status:"active"}}):n("a-row",{attrs:{type:"flex",justify:"center"}},["image"===e.previewType&&e.data?n("img",{attrs:{src:e.data}}):"text"===e.previewType&&e.data?n("a-col",{attrs:{flex:"1"}},[n("p",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(e.data))])]):e._e()],1)]:[n("a-row",{attrs:{type:"flex",justify:"center"}},[e._v(" 文件不支持预览 ")])]],2)],1)},de=[],pe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-icon",{attrs:{type:e.type,theme:"twoTone"}})},he=[],ge={props:{fileType:String},computed:{type:function(){return/^image\//.test(this.fileType)?"file-image":/^text\//.test(this.fileType)?"file-text":/^application\/pdf/.test(this.fileType)?"file-pdf":/^application\/zip/.test(this.fileType)?"file-zip":"file"}}},me=ge,ve=Object(z["a"])(me,pe,he,!1,null,null,null),ye=ve.exports,be={name:"FileInfo",components:{TitleIcon:ye},data:function(){return{fileLoading:!0,detailLoading:!0,detail:{url:""},data:void 0,percent:0,err:{},saveLoading:!1}},computed:{previewType:function(){var e=this.detail.type;return/^image\//.test(e)?"image":/^text\//.test(e)?"text":""}},watch:{"detail.url":function(){this.handlePreview()}},mounted:function(){this.getUrl()},methods:{getUrl:function(){var e=this,t=this.$route.params.hash,n=this.$route.query.name;this.detailLoading=!0,D(t).then((function(a){var r=a.type.replace(/.+\/(.+?)(;.+)?$/,"$1");"plain"===r&&(r="txt"),e.detail=Object(g["a"])(Object(g["a"])({},a),{},{format:r,name:n||"".concat(t,".").concat(r)}),e.handleUrl()})).catch(this.handleErr).finally((function(){e.detailLoading=!1}))},handleUrl:function(){var e=this.$route.params.hash,t=this.$options.filters,n=t.cdn,a=t.formatHash;this.detail.public?this.detail.url=n(e):this.detail.url="".concat($.OSS,"/private/").concat(a(e))},handlePreview:function(){"image"===this.previewType?this.handleImage():"text"===this.previewType&&this.handleText()},getFileData:function(e){var t=this;return this.fileLoading=!0,this.getFileAuth().then((function(n){return v.a.get(t.detail.url,{params:{auth:n},responseType:e,onDownloadProgress:function(e){var n=e.total,a=e.loaded;t.percent=r.a.floor(a/n*100)}}).then((function(e){return e.data})).catch((function(e){return t.previewType="",Promise.reject(e)})).finally((function(){setTimeout((function(){t.fileLoading=!1}),400)}))}))},handleImage:function(){var e=this;this.getFileData("blob").then((function(t){L(t).then((function(t){t=t.replace(/^(data:)application\/octet-stream/,"$1".concat(e.detail.type)),E(t).then((function(){e.data=t})).catch((function(){e.previewType=""}))}))}))},handleText:function(){var e=this;this.getFileData().then((function(t){e.data=t}))},getFileAuth:function(){return this.detail.public?Promise.resolve():O()?U():(this.$router.goLogin(),Promise.reject())},handleErr:function(e){this.err={status:r.a.get(e,"response.status")||e.status,message:r.a.get(e,"response.data")||e.message}},saveAs:function(){var e=this;this.detail.url?(this.saveLoading=!0,this.getFileData("blob").then((function(t){window.saveAs(t,e.detail.name)})).catch((function(){e.getFileAuth().then((function(t){var n=t?"".concat(e.detail.url,"?auth=").concat(t):e.detail.url;window.saveAs(n,e.detail.name)}))})).finally((function(){e.saveLoading=!1}))):this.$message.loading("加载中")}}},xe=be,we=Object(z["a"])(xe,fe,de,!1,null,null,null),_e=we.exports;o.a.use(ie.a);var Oe=new ie.a({mode:"history",base:"/",routes:[{name:"404",path:"/404",component:ue},{name:"info",path:"/:hash",component:_e}]});Oe.beforeEach((function(e,t,n){"404"===e.name||/^[0-9a-z]{32}$/.test(e.params.hash)?e.query.auth?(S(e.query.auth),Oe.replace(r.a.pick(Object(g["a"])(Object(g["a"])({},e),{},{query:r.a.omit(e.query,["auth"])}),["name","params","query"]))):n():Oe.replace("/404")})),Oe.goLogin=function(){window.location.href="".concat($.ACCOUNT_FRONTEND,"/login?redirect=").concat(encodeURIComponent(window.location.href.replace(/(\?|&)auth=.+$/,"")))};var Se=Oe,je=n("b819");Object(je["a"])("/service-worker.js",{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});n("ef2a"),n("91eb"),n("7d7b");var Te=function(e){return e.replace(/^(.{2})(.{2})/,"$1/$2/")};r.a.forEach({unixFormat:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LLL";return e>0?b.a.unix(e).format(t):"-"},accountF:function(e){return $.ACCOUNT_FRONTEND+e},formatHash:Te,oss:function(e){return"".concat($.OSS,"/").concat(Te(e))},cdn:function(e){return"".concat($.CDN,"/").concat(Te(e))}},(function(e,t){o.a.filter(t,(function(t){for(var n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return e.apply(void 0,[t].concat(a))}))})),o.a.config.productionTip=!1,o.a.use(c.a),s["notification"].config({top:"70px"});var Fe=document.getElementById("loading");r.a.set(Fe,"style.display","none"),new o.a({router:Se,render:function(e){return e(ae)}}).$mount("#app")},"60bb":function(e,t){e.exports=_},6389:function(e,t){e.exports=VueRouter},"8bbf":function(e,t){e.exports=Vue},"9b19":function(e,t,n){e.exports=n.p+"img/logo.652d41ec.svg"},c32d:function(e,t){e.exports=moment},cebe:function(e,t){e.exports=axios}});
//# sourceMappingURL=app.231f2395.js.map