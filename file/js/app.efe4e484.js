(function(e){function t(t){for(var r,i,s=t[0],c=t[1],l=t[2],f=0,d=[];f<s.length;f++)i=s[f],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&d.push(a[i][0]),a[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);u&&u(t);while(d.length)d.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},a={app:0},o=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="https://cdn.jsdelivr.net/gh/lin09/dist/file/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"4e72":function(e,t){e.exports=antd},"56d7":function(e,t,n){"use strict";n.r(t);n("bf53"),n("b7eb"),n("d7c3"),n("c304");var r=n("60bb"),a=n.n(r),o=n("8bbf"),i=n.n(o),s=n("4e72"),c=n.n(s),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("a-layout",{staticStyle:{"min-height":"100vh"}},[n("Header"),n("a-layout-content",[n("router-view")],1),n("a-layout-footer",{staticStyle:{"text-align":"center"}},[e._v(" FOS v."+e._s(e.APP_VERSION)+" ©2020 Created by "),n("a",{attrs:{href:"https://saileidigi.cn",target:"_blank",rel:"noopener noreferrer"}},[e._v(" saileidigi ")])])],1)],1)},u=[],f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a-layout-header",{staticStyle:{background:"#fff"}},[r("a-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[r("a-row",{attrs:{type:"flex",align:"middle"}},[r("a-row",{attrs:{type:"flex",align:"middle"}},[r("img",{staticStyle:{height:"32px"},attrs:{alt:"File logo",src:n("9b19")}}),r("h1",{staticStyle:{margin:"0 8px"}},[e._v("文件")])])],1),r("a-row",{attrs:{type:"flex",align:"middle"}},[r("UserMenu"),r("Fullscreen")],1)],1)],1)},d=[],p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-row",{attrs:{type:"flex",align:"middle"}},[e.detail.id?n("a-dropdown",{attrs:{placement:"bottomCenter"}},[n("a",{staticClass:"ant-dropdown-link",staticStyle:{margin:"0 20px","line-height":"32px"}},[n("a-row",{attrs:{type:"flex",align:"middle"}},[[e.detail.avatar?n("a-avatar",{attrs:{src:e._f("cdn")(e.detail.avatar)}}):n("a-avatar",{staticStyle:{background:"#1890ff"},attrs:{icon:"user"}})],n("span",{staticStyle:{"margin-left":"8px"}},[e._v(" "+e._s(e.detail.name)+" ")])],2)],1),n("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[n("a-menu-item",[n("a",{staticStyle:{padding:"8px 40px"},attrs:{href:e._f("accountF")("/")}},[n("a-icon",{attrs:{type:"appstore"}}),e._v(" 我的系统 ")],1)]),n("a-menu-item",[n("a",{staticStyle:{padding:"8px 40px"},attrs:{href:e._f("accountF")("/user")}},[n("a-icon",{attrs:{type:"user"}}),e._v(" 个人中心 ")],1)]),n("a-menu-item",[n("a",{staticStyle:{padding:"8px 40px"},attrs:{href:e._f("accountF")("/loginList")}},[n("a-icon",{attrs:{type:"login"}}),e._v(" 登录记录 ")],1)]),n("a-menu-divider"),n("a-menu-item",[n("a-button",{attrs:{block:"",type:"link",icon:"logout",size:"small"},on:{click:e.logout}},[e._v(" 退出 ")])],1)],1)],1):n("a-button",{attrs:{type:"link"},on:{click:e.goLogin}},[e._v(" 登录 ")])],1)},h=[],g=n("3c43"),m=(n("9be4"),n("cebe")),v=n.n(m),y=(n("a20b"),n("ea0d"),n("c32d")),b=n.n(y),x="account_token",w=function(e){var t={};try{t=JSON.parse(atob((e+"").replace(/(.+)\..+/,"$1")))}catch(n){window.console.error(n)}return t},_=function(e){return w(e).exp>b()().unix()+1800},O=function(){var e=localStorage.getItem(x);return e&&_(e)?e:""},S=function(e){return!(!e||!_(e))&&(localStorage.setItem(x,e),!0)},j=function(){var e=O();return e?w(e).id:0},F=function(){return localStorage.removeItem(x)},T=function(e){var t=v.a.create(e);return t.interceptors.request.use((function(e){return!1!==e.useAuth&&(e.headers.auth=e.headers.auth||O()),e}),(function(e){return s["notification"].error({message:e.message}),Promise.reject(e)})),t.interceptors.response.use((function(e){return e.data}),(function(e){return!1!==e.config.showError&&s["notification"].error({message:a.a.get(e,"response.status")||e.message,description:a.a.get(e,"response.data")}),Promise.reject(e)})),t},E=function(e){return new Promise((function(t,n){var r=new FileReader;r.addEventListener("load",(function(){t(r.result)})),r.addEventListener("error",n),r.readAsDataURL(e)}))},L=function(e){return new Promise((function(t,n){var r=new Image;r.addEventListener("load",(function(){t(r)})),r.addEventListener("error",n),r.src=e}))},P=(n("7941"),{IS_DEV:!1});Object.freeze(P);var $="saileidigi.cn",k={OSS:"oss.".concat($),OOS:"oos.".concat($)};Object.freeze(k);var A={ACCOUNT_API:"https://account-api.".concat(k.OOS),ACCOUNT_FRONTEND:"https://account.".concat(k.OOS),OSS:"https://".concat(k.OSS),CDN:"https://cdn.jsdelivr.net/gh/lin09/files"};Object.freeze(A);var N=T({baseURL:A.ACCOUNT_API}),C=T({baseURL:A.OSS,useAuth:!1}),I=function(){return N.post("/query/all",{table:{name:"user",no_default_field:!0,fields:["id","avatar","name"],filters:[[["id","=",j()]]]}}).then((function(e){return e.data[0]}))},U=function(){return N.get("/file/auth")},D=function(e){return C.get("/info/"+e)},R={data:function(){return{detail:{id:j()}}},beforeMount:function(){var e=this;this.detail.id&&I().then((function(t){e.detail=Object(g["a"])({},t)}))},methods:{logout:function(){this.detail={},F()},goLogin:function(){this.$router.goLogin()}}},q=R,M=n("94cc"),z=Object(M["a"])(q,p,h,!1,null,null,null),V=z.exports,H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-icon",{staticStyle:{"font-size":"32px",cursor:"pointer"},attrs:{type:e.isFullscreen?"fullscreen-exit":"fullscreen"},on:{click:e.toggleFullscreen}})},J=[],B={data:function(){return{isFullscreen:!1}},methods:{toggleFullscreen:function(){this.isFullscreen?document.exitFullscreen():document.documentElement.requestFullscreen()}},mounted:function(){var e=this;document.addEventListener("fullscreenchange",(function(){e.isFullscreen=document.fullscreenElement}))}},G=B,K=Object(M["a"])(G,H,J,!1,null,null,null),Q=K.exports,W={components:{UserMenu:V,Fullscreen:Q}},X=W,Y=Object(M["a"])(X,f,d,!1,null,null,null),Z=Y.exports,ee={name:"app",components:{Header:Z},data:function(){return{APP_VERSION:"0.1.0"}}},te=ee,ne=Object(M["a"])(te,l,u,!1,null,null,null),re=ne.exports,ae=(n("41fd"),n("f1e0"),n("6389")),oe=n.n(ae),ie=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-result",{attrs:{status:"404",title:"404",subTitle:"Sorry, the page you visited does not exist."}})},se=[],ce={},le=Object(M["a"])(ce,ie,se,!1,null,null,null),ue=le.exports,fe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{padding:"20px"}},[e.detailLoading?n("a-spin"):e.err.status?n("a-result",{attrs:{status:"error",title:e.err.status,subTitle:e.err.message}}):n("a-card",{staticStyle:{margin:"auto","max-width":"1024px"}},[n("span",{attrs:{slot:"title"},slot:"title"},[n("TitleIcon",{attrs:{"file-type":e.detail.type}}),e._v(" "+e._s(e.detail.name)+" ")],1),n("a-button",{attrs:{slot:"extra",type:"link"},on:{click:e.saveAs},slot:"extra"},[e._v(" 另存为 ")]),e.previewType?[e.fileLoading?n("a-progress",{attrs:{percent:e.percent,status:"active"}}):n("a-row",{attrs:{type:"flex",justify:"center"}},["image"===e.previewType&&e.data?n("img",{attrs:{src:e.data}}):"text"===e.previewType&&e.data?n("a-col",{attrs:{flex:"1"}},[n("p",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(e.data))])]):e._e()],1)]:[n("a-row",{attrs:{type:"flex",justify:"center"}},[e._v(" 文件不支持预览 ")])]],2)],1)},de=[],pe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-icon",{attrs:{type:e.type,theme:"twoTone"}})},he=[],ge={props:{fileType:String},computed:{type:function(){return/^image\//.test(this.fileType)?"file-image":"file"}}},me=ge,ve=Object(M["a"])(me,pe,he,!1,null,null,null),ye=ve.exports,be={name:"FileInfo",components:{TitleIcon:ye},data:function(){return{fileLoading:!0,detailLoading:!0,detail:{url:""},data:void 0,percent:0,err:{}}},computed:{previewType:function(){var e=this.detail.type;return/^image\//.test(e)?"image":/^text\//.test(e)?"text":""}},watch:{"detail.url":function(){this.handlePreview()}},mounted:function(){this.getUrl()},methods:{getUrl:function(){var e=this,t=this.$route.params.hash,n=this.$route.query.name;this.detailLoading=!0,D(t).then((function(r){var a=r.type.replace(/.+\/(.+?)(;.+)?$/,"$1");"plain"===a&&(a="txt"),e.detail=Object(g["a"])(Object(g["a"])({},r),{},{format:a,name:n||"".concat(t,".").concat(a)}),e.handleUrl()})).catch(this.handleErr).finally((function(){e.detailLoading=!1}))},handleUrl:function(){var e=this.$route.params.hash,t=this.$options.filters,n=t.cdn,r=t.formatHash;this.detail.public?this.detail.url=n(e):this.detail.url="".concat(A.OSS,"/private/").concat(r(e))},handlePreview:function(){"image"===this.previewType?this.handleImage():"text"===this.previewType&&this.handleText()},getFileData:function(e){var t=this;return this.fileLoading=!0,this.getFileAuth().then((function(n){return v.a.get(t.detail.url,{params:{auth:n},responseType:e,onDownloadProgress:function(e){var n=e.total,r=e.loaded;t.percent=a.a.floor(r/n*100)}}).then((function(e){return e.data})).catch((function(e){return t.previewType="",Promise.reject(e)})).finally((function(){setTimeout((function(){t.fileLoading=!1}),400)}))}))},handleImage:function(){var e=this;this.getFileData("blob").then((function(t){E(t).then((function(t){t=t.replace(/^(data:)application\/octet-stream/,"$1".concat(e.detail.type)),L(t).then((function(){e.data=t})).catch((function(){e.previewType=""}))}))}))},handleText:function(){var e=this;this.getFileData().then((function(t){e.data=t}))},getFileAuth:function(){return this.detail.public?Promise.resolve():O()?U():(this.$router.goLogin(),Promise.reject())},handleErr:function(e){this.err={status:a.a.get(e,"response.status")||e.status,message:a.a.get(e,"response.data")||e.message}},saveAs:function(){var e=this;this.detail.url?this.getFileAuth().then((function(t){var n=t?"".concat(e.detail.url,"?auth=").concat(t):e.detail.url;window.saveAs(n,e.detail.name)})):this.$message.loading("加载中")}}},xe=be,we=Object(M["a"])(xe,fe,de,!1,null,null,null),_e=we.exports;i.a.use(oe.a);var Oe=new oe.a({mode:"history",base:"/",routes:[{name:"404",path:"/404",component:ue},{name:"info",path:"/:hash",component:_e}]});Oe.beforeEach((function(e,t,n){"404"===e.name||/^[0-9a-z]{32}$/.test(e.params.hash)?e.query.auth?(S(e.query.auth),Oe.replace(a.a.pick(Object(g["a"])(Object(g["a"])({},e),{},{query:a.a.omit(e.query,["auth"])}),["name","params","query"]))):n():Oe.replace("/404")})),Oe.goLogin=function(){window.location.href="".concat(A.ACCOUNT_FRONTEND,"/login?redirect=").concat(encodeURIComponent(window.location.href.replace(/(\?|&)auth=.+$/,"")))};var Se=Oe,je=n("b819");Object(je["a"])("/service-worker.js",{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});n("ef2a"),n("91eb"),n("7d7b");var Fe=function(e){return e.replace(/^(.{2})(.{2})/,"$1/$2/")};a.a.forEach({unixFormat:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LLL";return e>0?b.a.unix(e).format(t):"-"},accountF:function(e){return A.ACCOUNT_FRONTEND+e},formatHash:Fe,oss:function(e){return"".concat(A.OSS,"/").concat(Fe(e))},cdn:function(e){return"".concat(A.CDN,"/").concat(Fe(e))}},(function(e,t){i.a.filter(t,(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return e.apply(void 0,[t].concat(r))}))})),i.a.config.productionTip=!1,i.a.use(c.a),s["notification"].config({top:"70px"});var Te=document.getElementById("loading");a.a.set(Te,"style.display","none"),new i.a({router:Se,render:function(e){return e(re)}}).$mount("#app")},"60bb":function(e,t){e.exports=_},6389:function(e,t){e.exports=VueRouter},"8bbf":function(e,t){e.exports=Vue},"9b19":function(e,t,n){e.exports=n.p+"img/logo.652d41ec.svg"},c32d:function(e,t){e.exports=moment},cebe:function(e,t){e.exports=axios}});
//# sourceMappingURL=app.efe4e484.js.map