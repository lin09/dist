(function(t){function e(e){for(var a,i,c=e[0],s=e[1],l=e[2],f=0,d=[];f<c.length;f++)i=c[f],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&d.push(r[i][0]),r[i]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a]);u&&u(e);while(d.length)d.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],a=!0,c=1;c<n.length;c++){var s=n[c];0!==r[s]&&(a=!1)}a&&(o.splice(e--,1),t=i(i.s=n[0]))}return t}var a={},r={app:0},o=[];function i(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=a,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="https://cdn.jsdelivr.net/gh/lin09/dist/file/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var u=s;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"4e72":function(t,e){t.exports=antd},"56d7":function(t,e,n){"use strict";n.r(e);n("bf53"),n("b7eb"),n("d7c3"),n("c304");var a=n("60bb"),r=n.n(a),o=n("8bbf"),i=n.n(o),c=n("4e72"),s=n.n(c),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("a-layout",{staticStyle:{"min-height":"100vh"}},[n("Header"),n("a-layout-content",[n("router-view"),n("a-back-top")],1),n("a-layout-footer",{staticStyle:{"text-align":"center"}},[t._v(" FOS v."+t._s(t.APP_VERSION)+" ©2020 Created by "),n("a",{attrs:{href:"//"+t.DOMAIN,target:"_blank"}},[t._v(" "+t._s(t.DOMAIN)+" ")])])],1)],1)},u=[],f=(n("41fd"),n("7941"),n("a20b"),n("ea0d"),{IS_DEV:!1});Object.freeze(f);var d=location.hostname.replace(/.+?([a-z]+\.cn)$/,"$1"),p={OSS:"oss.".concat(d),OOS:"oos.".concat(d)};Object.freeze(p);var h={ACCOUNT_API:"".concat(location.protocol,"//account-api.").concat(p.OOS),ACCOUNT_FRONTEND:"".concat(location.protocol,"//account.").concat(p.OOS),OSS:"".concat(location.protocol,"//").concat(p.OSS),CDN:"https://cdn.jsdelivr.net/gh/lin09/files"};Object.freeze(h);var g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-layout-header",{staticStyle:{background:"#fff"}},[a("a-row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[a("a-row",{attrs:{type:"flex",align:"middle"}},[a("a-row",{attrs:{type:"flex",align:"middle"}},[a("img",{staticStyle:{height:"32px"},attrs:{alt:"File logo",src:n("9b19")}}),a("h1",{staticStyle:{margin:"0 8px"}},[t._v("文件")])])],1),a("a-row",{attrs:{type:"flex",align:"middle"}},[a("UserMenu"),a("Fullscreen")],1)],1)],1)},m=[],v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-row",{attrs:{type:"flex",align:"middle"}},[t.detail.id?n("a-dropdown",{attrs:{placement:"bottomCenter"}},[n("a",{staticClass:"ant-dropdown-link",staticStyle:{margin:"0 20px","line-height":"32px"}},[n("a-row",{attrs:{type:"flex",align:"middle"}},[[t.detail.avatar?n("a-avatar",{attrs:{src:t._f("cdn")(t.detail.avatar)}}):n("a-avatar",{staticStyle:{background:"#1890ff"},attrs:{icon:"user"}})],n("span",{staticStyle:{"margin-left":"8px"}},[t._v(" "+t._s(t.detail.name)+" ")])],2)],1),n("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[n("a-menu-item",[n("a",{staticStyle:{padding:"8px 40px"},attrs:{href:t._f("accountF")("/")}},[n("a-icon",{attrs:{type:"appstore"}}),t._v(" 我的系统 ")],1)]),n("a-menu-item",[n("a",{staticStyle:{padding:"8px 40px"},attrs:{href:t._f("accountF")("/user")}},[n("a-icon",{attrs:{type:"user"}}),t._v(" 个人中心 ")],1)]),n("a-menu-item",[n("a",{staticStyle:{padding:"8px 40px"},attrs:{href:t._f("accountF")("/loginList")}},[n("a-icon",{attrs:{type:"login"}}),t._v(" 登录记录 ")],1)]),n("a-menu-divider"),n("a-menu-item",[n("a-button",{attrs:{block:"",type:"link",icon:"logout",size:"small"},on:{click:t.logout}},[t._v(" 退出 ")])],1)],1)],1):n("a-button",{attrs:{type:"link"},on:{click:t.goLogin}},[t._v(" 登录 ")])],1)},y=[],b=n("3c43"),x=(n("9be4"),n("cebe")),w=n.n(x),_=n("c32d"),O=n.n(_),S="account_token",j=function(t){var e={};try{e=JSON.parse(atob((t+"").replace(/(.+)\..+/,"$1")))}catch(n){window.console.error(n)}return e},T=function(t){return j(t).exp>O()().unix()+1800},F=function(){var t=localStorage.getItem(S);return t&&T(t)?t:""},L=function(t){return!(!t||!T(t))&&(localStorage.setItem(S,t),!0)},E=function(){var t=F();return t?j(t).id:0},A=function(){return localStorage.removeItem(S)},$=function(t){var e=w.a.create(t);return e.interceptors.request.use((function(t){return!1!==t.useAuth&&(t.headers.auth=t.headers.auth||F()),t}),(function(t){return c["notification"].error({message:t.message}),Promise.reject(t)})),e.interceptors.response.use((function(t){return t.data}),(function(t){return!1!==t.config.showError&&c["notification"].error({message:r.a.get(t,"response.status")||t.message,description:r.a.get(t,"response.data")}),Promise.reject(t)})),e},k=function(t){return new Promise((function(e,n){var a=new FileReader;a.addEventListener("load",(function(){e(a.result)})),a.addEventListener("error",n),a.readAsDataURL(t)}))},P=function(t){return new Promise((function(e,n){var a=new Image;a.addEventListener("load",(function(){e(a)})),a.addEventListener("error",n),a.src=t}))},N=$({baseURL:h.ACCOUNT_API}),I=$({baseURL:h.OSS,useAuth:!1}),C=function(){return N.post("/query/all",{table:{name:"user",no_default_field:!0,fields:["id","avatar","name"],filters:[[["id","=",E()]]]}}).then((function(t){return t.data[0]}))},D=function(){return N.get("/file/auth")},U=function(t){return I.get("/info/"+t)},R={data:function(){return{detail:{id:E()}}},beforeMount:function(){var t=this;this.detail.id&&C().then((function(e){t.detail=Object(b["a"])({},e)}))},methods:{logout:function(){this.detail={},A()},goLogin:function(){this.$router.goLogin()}}},q=R,M=n("94cc"),z=Object(M["a"])(q,v,y,!1,null,null,null),V=z.exports,H=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-icon",{staticStyle:{"font-size":"32px",cursor:"pointer"},attrs:{type:t.isFullscreen?"fullscreen-exit":"fullscreen"},on:{click:t.toggleFullscreen}})},J=[],B={data:function(){return{isFullscreen:!1}},methods:{toggleFullscreen:function(){this.isFullscreen?document.exitFullscreen():document.documentElement.requestFullscreen()}},mounted:function(){var t=this;document.addEventListener("fullscreenchange",(function(){t.isFullscreen=document.fullscreenElement}))}},G=B,K=Object(M["a"])(G,H,J,!1,null,null,null),Q=K.exports,W={components:{UserMenu:V,Fullscreen:Q}},X=W,Y=Object(M["a"])(X,g,m,!1,null,null,null),Z=Y.exports,tt={name:"app",components:{Header:Z},data:function(){return{DOMAIN:d,APP_VERSION:"0.1.0"}}},et=tt,nt=Object(M["a"])(et,l,u,!1,null,null,null),at=nt.exports,rt=(n("f1e0"),n("6389")),ot=n.n(rt),it=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-result",{attrs:{status:"404",title:"404",subTitle:"Sorry, the page you visited does not exist."}})},ct=[],st={},lt=Object(M["a"])(st,it,ct,!1,null,null,null),ut=lt.exports,ft=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{padding:"20px"}},[t.detailLoading?n("a-spin"):t.err.status?n("a-result",{attrs:{status:"error",title:t.err.status,subTitle:t.err.message}}):n("a-card",{staticStyle:{margin:"auto","max-width":"1024px"}},[n("span",{attrs:{slot:"title"},slot:"title"},[n("TitleIcon",{attrs:{"file-type":t.detail.type}}),t._v(" "+t._s(t.detail.name)+" ")],1),n("a-button",{attrs:{slot:"extra",type:"link",loading:t.saveLoading},on:{click:t.saveAs},slot:"extra"},[t._v(" 另存为 ")]),t.previewType?[t.fileLoading&&!t.saveLoading?n("a-progress",{attrs:{percent:t.percent,status:"active"}}):t.data?n("a-row",{attrs:{type:"flex",justify:"center"}},["image"===t.previewType?n("img",{attrs:{src:t.data}}):"text"===t.previewType?n("a-col",{attrs:{flex:"1"}},[n("p",{staticStyle:{"white-space":"pre-wrap"}},[t._v(t._s(t.data))])]):t._e()],1):t._e()]:[n("a-row",{attrs:{type:"flex",justify:"center"}},[t._v(" 文件不支持预览 ")])]],2)],1)},dt=[],pt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-icon",{attrs:{type:t.type,theme:"twoTone"}})},ht=[],gt={props:{fileType:String},computed:{type:function(){return/^image\//.test(this.fileType)?"file-image":/^text\//.test(this.fileType)?"file-text":/^application\/pdf/.test(this.fileType)?"file-pdf":/^application\/zip/.test(this.fileType)?"file-zip":"file"}}},mt=gt,vt=Object(M["a"])(mt,pt,ht,!1,null,null,null),yt=vt.exports,bt={name:"FileInfo",components:{TitleIcon:yt},data:function(){return{fileLoading:!0,detailLoading:!0,detail:{url:""},data:void 0,percent:0,err:{},saveLoading:!1}},computed:{previewType:function(){var t=this.detail.type;return/^image\//.test(t)?"image":/^text\//.test(t)?"text":""}},watch:{"detail.url":function(){this.handlePreview()}},mounted:function(){this.getUrl()},methods:{getUrl:function(){var t=this,e=this.$route.params.hash,n=this.$route.query.name;this.detailLoading=!0,U(e).then((function(a){var r=a.type.replace(/.+\/(.+?)(;.+)?$/,"$1");"plain"===r&&(r="txt"),t.detail=Object(b["a"])(Object(b["a"])({},a),{},{format:r,name:n||"".concat(e,".").concat(r)}),t.handleUrl()})).catch(this.handleErr).finally((function(){t.detailLoading=!1}))},handleUrl:function(){var t=this.$route.params.hash,e=this.$options.filters,n=e.cdn,a=e.formatHash;this.detail.public?this.detail.url=n(t):this.detail.url="".concat(h.OSS,"/private/").concat(a(t))},handlePreview:function(){"image"===this.previewType?this.handleImage():"text"===this.previewType&&this.handleText()},getFileData:function(t){var e=this;return this.fileLoading=!0,this.getFileAuth().then((function(n){return w.a.get(e.detail.url,{params:{auth:n},responseType:t,onDownloadProgress:function(t){var n=t.total,a=t.loaded;e.percent=r.a.floor(a/n*100)}}).then((function(t){return t.data})).catch((function(t){return e.previewType="",Promise.reject(t)})).finally((function(){setTimeout((function(){e.fileLoading=!1}),400)}))}))},handleImage:function(){var t=this;this.getFileData("blob").then((function(e){k(e).then((function(e){e=e.replace(/^(data:)application\/octet-stream/,"$1".concat(t.detail.type)),P(e).then((function(){t.data=e})).catch((function(){t.previewType=""}))}))}))},handleText:function(){var t=this;this.getFileData().then((function(e){t.data=e}))},getFileAuth:function(){return this.detail.public?Promise.resolve():F()?D():(this.$router.goLogin(),Promise.reject())},handleErr:function(t){this.err={status:r.a.get(t,"response.status")||t.status,message:r.a.get(t,"response.data")||t.message}},saveAs:function(){var t=this;this.detail.url?(this.saveLoading=!0,this.getFileData("blob").then((function(e){window.saveAs(e,t.detail.name)})).catch((function(){t.getFileAuth().then((function(e){var n=e?"".concat(t.detail.url,"?auth=").concat(e):t.detail.url;window.saveAs(n,t.detail.name)}))})).finally((function(){setTimeout((function(){t.saveLoading=!1}),400)}))):this.$message.loading("加载中")}}},xt=bt,wt=Object(M["a"])(xt,ft,dt,!1,null,null,null),_t=wt.exports;i.a.use(ot.a);var Ot=new ot.a({mode:"history",base:"/",routes:[{name:"404",path:"/404",component:ut},{name:"info",path:"/:hash",component:_t}]});Ot.beforeEach((function(t,e,n){"404"===t.name||/^[0-9a-z]{32}$/.test(t.params.hash)?t.query.auth?(L(t.query.auth),Ot.replace(r.a.pick(Object(b["a"])(Object(b["a"])({},t),{},{query:r.a.omit(t.query,["auth"])}),["name","params","query"]))):n():Ot.replace("/404")})),Ot.goLogin=function(){window.location.href="".concat(h.ACCOUNT_FRONTEND,"/login?redirect=").concat(encodeURIComponent(window.location.href.replace(/(\?|&)auth=.+$/,"")))};var St=Ot,jt=n("b819");Object(jt["a"])("/service-worker.js",{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});n("ef2a"),n("91eb"),n("7d7b");var Tt=function(t){return t.replace(/^(.{2})(.{2})/,"$1/$2/")};r.a.forEach({unixFormat:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LLL";return t>0?O.a.unix(t).format(e):"-"},accountF:function(t){return h.ACCOUNT_FRONTEND+t},formatHash:Tt,oss:function(t){return"".concat(h.OSS,"/").concat(Tt(t))},cdn:function(t){return"".concat(h.CDN,"/").concat(Tt(t))}},(function(t,e){i.a.filter(e,(function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return t.apply(void 0,[e].concat(a))}))})),i.a.config.productionTip=!1,i.a.use(s.a),c["notification"].config({top:"70px"});var Ft=document.getElementById("loading");r.a.set(Ft,"style.display","none"),new i.a({router:St,render:function(t){return t(at)}}).$mount("#app")},"60bb":function(t,e){t.exports=_},6389:function(t,e){t.exports=VueRouter},"8bbf":function(t,e){t.exports=Vue},"9b19":function(t,e,n){t.exports=n.p+"img/logo.652d41ec.svg"},c32d:function(t,e){t.exports=moment},cebe:function(t,e){t.exports=axios}});
//# sourceMappingURL=app.f7c4bcf0.js.map